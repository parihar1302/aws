##ERROR:- Connection Refused or Timed out error or EC2 Unable to Access/login EC2 Instance                          https://aws.amazon.com/premiumsupport/knowledge-center/ec2-linux-resolve-ssh-connection-errors/
---------------------------------------------------

Senerio-1.) No such file or directory present

Solution:- Go to the pem file location & than try loging it.


Senerio-2.) Key does not have readonly (400 or 600) permission.

Solution:- chmod 400 key.pem


Senerio-3.) Connection Timed Out, Port (22).Security Group port ssh (22) is not open.

Solution:- Security Group Port SSH > Source (your local computer IP).


Senerio-4.) Connection refused timed out.

Solution:- Verify wheather InternetGateway is attached to correct VPC or not.
           Verify Routing table connection is correct or not.



Senerio-5.) (SSM) System Session Manager  (when remote server ssh service doesn't respond/stop)

##Note:-{without ssh, ssm can login to the ec2 instance. By default "SSM Agent" installed in Ubuntu16/18.04, AMAZON Linux/Linux2, Amazon ECS-Optimised, windows server 2008/12 R2/16/19.}

a.) Go to System manager > Session manager > start a session

b.) if roles is not attached than go to the EC2 > action > Attach IAM role > New role > create AmazonSSMManagedEC2InstanceDefaultPolicy.

C.) Start a session

Type thes commands:-  
                 i.) sudo iptables -I INPUT 1 -p tcp --dport 22 -j ACCEPT      ##{disabling 22 rule from firewall}
                           OR
                 i.)  sudo iptables -F                           ##{Disabling whole Firewall, it will remove all rules which are added}
                ii.)  sudo iptables -P INPUT ACCEPT         
               iii.)  sudo ufw disable
               

d.) Now restart SSH service & verify wheather it's running or not:-
                ii.)  sudo service sshd restart                  ##{Restarting SSH service}
               iii.)  sudo netstat -tnlp | grep :22              ##{Verifing SSH service}
                            OR
                      sudo ss -tpln | grep -E '22|ssh'


e.)  Terminate session

f.) Go to EC2 and connect using SSH (normal connect method) 



Senerio-6.) Recover Pem file (create new instance and detach primary instance volume and attach with new ec2 instance and mount the volume than again vice-versa of the same volume and login the primary instance. )


Senerio-7.) When Server Refused to take the key :-=  (USERDATA :- /.ssh) 
            --------------------------------------

a.) Stop the instance

b.) Go to the terminal(CLI) and generate a new key.

# ssh-keygen -y -f key.pem         ##{generate key and copy the content}


c.) Go to the Knowldge-Center Artical and copy the code              {https://aws.amazon.com/premiumsupport/knowledge-center/ec2-server-refused-our-key}

#cloud-config
 ssh_deletekeys: false
 ssh_authorized_key:
   - ssh-rsa ENTER KEY PAIR CONTENT HERE...
 cloud_final_modules:
   - [ssh, always]



d.) Go to the Dashboard > select instance > Action > View/Change UserData > Paste the knowledge-center code and in that Paste the Key content in as "ENTER KEY PAIR CONTENT HERE..." > Save

e.) Restart the instance 

f.) Login to the instance


Senerio-8.) Unable to access.

Solution:- Change instance size from t2 to t3. Somtimes due to low RAM & Vcpu screen, it gets stuck in few .


Seneio-9.) Frozen terminal screen after instance connection.

Solution:- Due to local ISP (internet service provider) this issue occurs. Better you standard ISP like:- Jio, Airtel & etc

